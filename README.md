# ğŸš€ Há»‡ Thá»‘ng ML Dá»± ÄoÃ¡n HÃ nh Vi Mua HÃ ng Cá»§a KhÃ¡ch HÃ ng

Má»™t pipeline MLOps chuyá»ƒn Ä‘á»•i dá»¯ liá»‡u hÃ nh vi thÆ°Æ¡ng máº¡i Ä‘iá»‡n tá»­ thÃ nh cÃ¡c dá»± Ä‘oÃ¡n mua hÃ ng thá»i gian thá»±c. ÄÆ°á»£c xÃ¢y dá»±ng trÃªn cÃ¡c cÃ´ng nghá»‡ mÃ£ nguá»“n má»Ÿ hiá»‡n Ä‘áº¡i bao gá»“m Kafka, Flink, Spark, Ray vÃ  MLflow, dá»± Ã¡n nÃ y minh há»a má»™t vÃ²ng Ä‘á»i ML hoÃ n chá»‰nh tá»« viá»‡c thu náº¡p dá»¯ liá»‡u Ä‘áº¿n triá»ƒn khai mÃ´ hÃ¬nh. Há»‡ thá»‘ng cÃ³ tÃ­nh nÄƒng CDC (Change Data Capture - Báº¯t Dá»¯ liá»‡u Thay Ä‘á»•i) tá»± Ä‘á»™ng, kho dá»¯ liá»‡u Ä‘a táº§ng, cung cáº¥p Ä‘áº·c trÆ°ng (feature serving) thá»i gian thá»±c vÃ  kháº£ nÄƒng quan sÃ¡t (observability) toÃ n diá»‡n.

## ğŸ“‘ Má»¥c lá»¥c

  - [ğŸ“Š Táº­p Dá»¯ liá»‡u](https://www.google.com/search?q=%23-t%E1%BA%ADp-d%E1%BB%AF-li%E1%BB%87u)
      - [Cáº¥u trÃºc tá»‡p](https://www.google.com/search?q=%23c%E1%BA%A5u-tr%C3%BAc-t%E1%BB%87p)
      - [CÃ¡c loáº¡i sá»± kiá»‡n](https://www.google.com/search?q=%23c%C3%A1c-lo%E1%BA%A1i-s%E1%BB%B1-ki%E1%BB%87n)
      - [MÃ´ hÃ¬nh hÃ³a: Dá»± Ä‘oÃ¡n HÃ nh vi Mua hÃ ng cá»§a KhÃ¡ch hÃ ng](https://www.google.com/search?q=%23m%C3%B4-h%C3%ACnh-h%C3%B3a-d%E1%BB%B1-%C4%91o%C3%A1n-h%C3%A0nh-vi-mua-h%C3%A0ng-c%E1%BB%A7a-kh%C3%A1ch-h%C3%A0ng)
  - [ğŸŒ Tá»•ng Quan Kiáº¿n TrÃºc](https://www.google.com/search?q=%23-t%E1%BB%95ng-quan-ki%E1%BA%BFn-tr%C3%BAc)
      - [1. Luá»“ng Dá»¯ liá»‡u (Data Pipeline)](https://www.google.com/search?q=%231-lu%E1%BB%93ng-d%E1%BB%AF-li%E1%BB%87u-data-pipeline)
          - [ğŸ“¤ Nguá»“n Dá»¯ liá»‡u](https://www.google.com/search?q=%23-ngu%E1%BB%93n-d%E1%BB%AF-li%E1%BB%87u)
          - [âœ… XÃ¡c thá»±c LÆ°á»£c Ä‘á»“ (Schema Validation)](https://www.google.com/search?q=%23-x%C3%A1c-th%E1%BB%B1c-l%C6%B0%E1%BB%A3c-%C4%91%E1%BB%93-schema-validation)
          - [â˜ï¸ Táº§ng LÆ°u trá»¯](https://www.google.com/search?q=%23-t%E1%BA%A7ng-l%C6%B0u-tr%E1%BB%AF)
          - [ğŸ›’ Spark Streaming](https://www.google.com/search?q=%23-spark-streaming)
      - [2. Luá»“ng Huáº¥n luyá»‡n (Training Pipeline)](https://www.google.com/search?q=%232-lu%E1%BB%93ng-hu%E1%BA%A5n-luy%E1%BB%87n-training-pipeline)
          - [ğŸŒŸ Huáº¥n luyá»‡n PhÃ¢n tÃ¡n](https://www.google.com/search?q=%23-hu%E1%BA%A5n-luy%E1%BB%87n-ph%C3%A2n-t%C3%A1n)
          - [ğŸ“¦ Quáº£n lÃ½ MÃ´ hÃ¬nh](https://www.google.com/search?q=%23-qu%E1%BA%A3n-l%C3%BD-m%C3%B4-h%C3%ACnh)
      - [3. Luá»“ng Phá»¥c vá»¥ (Serving Pipeline)](https://www.google.com/search?q=%233-lu%E1%BB%93ng-ph%E1%BB%A5c-v%E1%BB%A5-serving-pipeline)
          - [âš¡ Phá»¥c vá»¥ MÃ´ hÃ¬nh (Model Serving)](https://www.google.com/search?q=%23-ph%E1%BB%A5c-v%E1%BB%A5-m%C3%B4-h%C3%ACnh-model-serving)
          - [ğŸ” Dá»‹ch vá»¥ Äáº·c trÆ°ng (Feature Service)](https://www.google.com/search?q=%23-d%E1%BB%8Bch-v%E1%BB%A5-%C4%91%E1%BA%B7c-tr%C6%B0ng-feature-service)
      - [4. Kháº£ nÄƒng Quan sÃ¡t (Observability)](https://www.google.com/search?q=%234-kh%E1%BA%A3-n%C4%83ng-quan-s%C3%A1t-observability)
          - [ğŸ“¡ Chá»‰ sá»‘ & GiÃ¡m sÃ¡t](https://www.google.com/search?q=%23-ch%E1%BB%89-s%E1%BB%91--gi%C3%A1m-s%C3%A1t)
          - [ğŸ”’ Quáº£n lÃ½ Truy cáº­p](https://www.google.com/search?q=%23-qu%E1%BA%A3n-l%C3%BD-truy-c%E1%BA%ADp)

## ğŸ“Š Táº­p Dá»¯ liá»‡u

> Dá»¯ liá»‡u HÃ nh vi ThÆ°Æ¡ng máº¡i Äiá»‡n tá»­ tá»« Cá»­a hÃ ng Äa danh má»¥c

Táº­p dá»¯ liá»‡u cÃ³ thá»ƒ Ä‘Æ°á»£c tÃ¬m tháº¥y [táº¡i Ä‘Ã¢y](https://www.kaggle.com/datasets/mkechinov/ecommerce-behavior-data-from-multi-category-store/data). Táº­p dá»¯ liá»‡u nÃ y chá»©a dá»¯ liá»‡u hÃ nh vi tá»« hÆ¡n 285 triá»‡u sá»± kiá»‡n ngÆ°á»i dÃ¹ng trÃªn má»™t trang web thÆ°Æ¡ng máº¡i Ä‘iá»‡n tá»­ Ä‘a danh má»¥c lá»›n.

Dá»¯ liá»‡u kÃ©o dÃ i 7 thÃ¡ng (tá»« thÃ¡ng 10 nÄƒm 2019 Ä‘áº¿n thÃ¡ng 4 nÄƒm 2020) vÃ  ghi láº¡i cÃ¡c tÆ°Æ¡ng tÃ¡c giá»¯a ngÆ°á»i dÃ¹ng vÃ  sáº£n pháº©m nhÆ° lÆ°á»£t xem, thÃªm/xÃ³a khá»i giá» hÃ ng vÃ  mua hÃ ng. Má»—i sá»± kiá»‡n Ä‘áº¡i diá»‡n cho má»™t má»‘i quan há»‡ nhiá»u-nhiá»u giá»¯a ngÆ°á»i dÃ¹ng vÃ  sáº£n pháº©m.

Táº­p dá»¯ liá»‡u Ä‘Æ°á»£c thu tháº­p bá»Ÿi dá»± Ã¡n Open CDP, má»™t ná»n táº£ng dá»¯ liá»‡u khÃ¡ch hÃ ng mÃ£ nguá»“n má»Ÿ cho phÃ©p theo dÃµi vÃ  phÃ¢n tÃ­ch dá»¯ liá»‡u hÃ nh vi ngÆ°á»i dÃ¹ng.

### Cáº¥u trÃºc tá»‡p

| TrÆ°á»ng         | MÃ´ táº£                                                                |
| -------------- | -------------------------------------------------------------------- |
| event\_time     | Dáº¥u thá»i gian UTC khi sá»± kiá»‡n xáº£y ra                                  |
| event\_type     | Loáº¡i sá»± kiá»‡n tÆ°Æ¡ng tÃ¡c cá»§a ngÆ°á»i dÃ¹ng                                    |
| product\_id     | MÃ£ Ä‘á»‹nh danh duy nháº¥t cho sáº£n pháº©m                                     |
| category\_id    | MÃ£ Ä‘á»‹nh danh danh má»¥c sáº£n pháº©m                                        |
| category\_code  | PhÃ¢n loáº¡i danh má»¥c sáº£n pháº©m (khi cÃ³ sáºµn cho cÃ¡c danh má»¥c cÃ³ Ã½ nghÄ©a) |
| brand          | TÃªn thÆ°Æ¡ng hiá»‡u (chá»¯ thÆ°á»ng, cÃ³ thá»ƒ thiáº¿u)                            |
| price          | GiÃ¡ sáº£n pháº©m (sá»‘ thá»±c - float)                                         |
| user\_id        | MÃ£ Ä‘á»‹nh danh ngÆ°á»i dÃ¹ng vÄ©nh viá»…n                                       |
| user\_session   | ID phiÃªn táº¡m thá»i, thay Ä‘á»•i sau thá»i gian dÃ i ngÆ°á»i dÃ¹ng khÃ´ng hoáº¡t Ä‘á»™ng |

### CÃ¡c loáº¡i sá»± kiá»‡n

Táº­p dá»¯ liá»‡u ghi láº¡i bá»‘n loáº¡i tÆ°Æ¡ng tÃ¡c cá»§a ngÆ°á»i dÃ¹ng:

  - **view**: NgÆ°á»i dÃ¹ng Ä‘Ã£ xem má»™t sáº£n pháº©m
  - **cart**: NgÆ°á»i dÃ¹ng Ä‘Ã£ thÃªm má»™t sáº£n pháº©m vÃ o giá» hÃ ng
  - **remove\_from\_cart**: NgÆ°á»i dÃ¹ng Ä‘Ã£ xÃ³a má»™t sáº£n pháº©m khá»i giá» hÃ ng
  - **purchase**: NgÆ°á»i dÃ¹ng Ä‘Ã£ mua má»™t sáº£n pháº©m

### MÃ´ hÃ¬nh hÃ³a: Dá»± Ä‘oÃ¡n HÃ nh vi Mua hÃ ng cá»§a KhÃ¡ch hÃ ng

Nhiá»‡m vá»¥ mÃ´ hÃ¬nh hÃ³a cá»‘t lÃµi lÃ  dá»± Ä‘oÃ¡n liá»‡u ngÆ°á»i dÃ¹ng cÃ³ mua má»™t sáº£n pháº©m táº¡i thá»i Ä‘iá»ƒm há» thÃªm nÃ³ vÃ o giá» hÃ ng hay khÃ´ng.

#### Ká»¹ thuáº­t Äáº·c trÆ°ng (Feature Engineering)

ChÃºng tÃ´i biáº¿n Ä‘á»•i dá»¯ liá»‡u sá»± kiá»‡n thÃ´ thÃ nh cÃ¡c Ä‘áº·c trÆ°ng cÃ³ Ã½ nghÄ©a cho mÃ´ hÃ¬nh há»c mÃ¡y cá»§a mÃ¬nh. PhÃ¢n tÃ­ch táº­p trung Ä‘áº·c biá»‡t vÃ o cÃ¡c sá»± kiá»‡n thÃªm vÃ o giá» hÃ ng vÃ  káº¿t quáº£ tiáº¿p theo cá»§a chÃºng.

CÃ¡c Ä‘áº·c trÆ°ng Ä‘Æ°á»£c thiáº¿t káº¿ chÃ­nh bao gá»“m:

| Äáº·c trÆ°ng            | MÃ´ táº£                                                           |
| -------------------- | --------------------------------------------------------------- |
| category\_code\_level1 | Danh má»¥c sáº£n pháº©m chÃ­nh                                         |
| category\_code\_level2 | Danh má»¥c phá»¥ cá»§a sáº£n pháº©m                                       |
| event\_weekday        | NgÃ y trong tuáº§n khi sá»± kiá»‡n thÃªm vÃ o giá» hÃ ng xáº£y ra             |
| activity\_count       | Tá»•ng sá»‘ hoáº¡t Ä‘á»™ng cá»§a ngÆ°á»i dÃ¹ng trong phiÃªn hiá»‡n táº¡i            |
| price                | GiÃ¡ gá»‘c cá»§a sáº£n pháº©m                                             |
| brand                | TÃªn thÆ°Æ¡ng hiá»‡u sáº£n pháº©m                                        |
| is\_purchased         | Biáº¿n má»¥c tiÃªu: liá»‡u máº·t hÃ ng trong giá» hÃ ng cuá»‘i cÃ¹ng cÃ³ Ä‘Æ°á»£c mua khÃ´ng |

Báº¡n cÃ³ thá»ƒ táº£i táº­p dá»¯ liá»‡u vá» vÃ  Ä‘áº·t nÃ³ vÃ o thÆ° má»¥c `data`.

## ğŸŒ Tá»•ng Quan Kiáº¿n TrÃºc

Há»‡ thá»‘ng bao gá»“m bá»‘n thÃ nh pháº§n chÃ­nhâ€”**Dá»¯ liá»‡u (Data)**, **Huáº¥n luyá»‡n (Training)**, **Phá»¥c vá»¥ (Serving)**, vÃ  **Kháº£ nÄƒng Quan sÃ¡t (Observability)**â€”cÃ¹ng vá»›i má»™t **MÃ´i trÆ°á»ng PhÃ¡t triá»ƒn (Dev Environment)** vÃ  má»™t **Kho MÃ´ hÃ¬nh (Model Registry)**.

### 1\. Luá»“ng Dá»¯ liá»‡u (Data Pipeline)

#### ğŸ“¤ Nguá»“n Dá»¯ liá»‡u

  - **Kafka Producer**: LiÃªn tá»¥c phÃ¡t cÃ¡c sá»± kiá»‡n hÃ nh vi ngÆ°á»i dÃ¹ng Ä‘áº¿n topic `tracking.raw_user_behavior`
  - **Dá»‹ch vá»¥ CDC**: Sá»­ dá»¥ng Debezium Ä‘á»ƒ báº¯t cÃ¡c thay Ä‘á»•i trong PostgreSQL, truyá»n dá»¯ liá»‡u Ä‘áº¿n `tracking_postgres_cdc.public.events`

#### âœ… XÃ¡c thá»±c LÆ°á»£c Ä‘á»“ (Schema Validation)

  - XÃ¡c thá»±c cÃ¡c sá»± kiá»‡n Ä‘áº¿n tá»« cáº£ hai nguá»“n
  - Äá»‹nh tuyáº¿n cÃ¡c sá»± kiá»‡n Ä‘áº¿n:
      - `tracking.user_behavior.validated` cho cÃ¡c sá»± kiá»‡n há»£p lá»‡
      - `tracking.user_behavior.invalid` cho cÃ¡c vi pháº¡m lÆ°á»£c Ä‘á»“
  - Xá»­ lÃ½ khoáº£ng 10 nghÃ¬n sá»± kiá»‡n/giÃ¢y
  - Cáº£nh bÃ¡o cÃ¡c sá»± kiá»‡n khÃ´ng há»£p lá»‡ Ä‘áº¿n Elasticsearch

#### â˜ï¸ Táº§ng LÆ°u trá»¯

  - **Data Lake (MinIO)**:
      - LÆ°u trá»¯ NgoÃ i (External Storage)
      - LÆ°u trá»¯ dá»¯ liá»‡u trong cÃ¡c bucket Ä‘Æ°á»£c phÃ¢n vÃ¹ng theo thá»i gian (nÄƒm/thÃ¡ng/ngÃ y/giá»)
      - Há»— trá»£ Ä‘iá»ƒm kiá»ƒm tra (checkpointing) cho kháº£ nÄƒng phá»¥c há»“i cá»§a pipeline
  - **Data Warehouse (PostgreSQL)**:
      - Tá»• chá»©c theo cÃ¡c lá»›p bronze â†’ silver â†’ gold
      - Chá»©a cÃ¡c báº£ng dimension/fact cho má»¥c Ä‘Ã­ch phÃ¢n tÃ­ch
  - **Offline Store (PostgreSQL)**:
      - ÄÆ°á»£c sá»­ dá»¥ng Ä‘á»ƒ huáº¥n luyá»‡n vÃ  cung cáº¥p Ä‘áº·c trÆ°ng theo lÃ´ (batch feature serving)
      - ÄÆ°á»£c cá»¥ thá»ƒ hÃ³a (materialized) Ä‘á»‹nh ká»³ vÃ o online store
  - **Online Store (Redis)**:
      - Cung cáº¥p Ä‘áº·c trÆ°ng vá»›i Ä‘á»™ trá»… tháº¥p
      - ÄÆ°á»£c cáº­p nháº­t thÃ´ng qua luá»“ng xá»­ lÃ½ streaming
      - ÄÆ°á»£c cung cáº¥p thÃ´ng qua API Truy xuáº¥t Äáº·c trÆ°ng (Feature Retrieval API)

#### ğŸ›’ Spark Streaming

  - Biáº¿n Ä‘á»•i cÃ¡c sá»± kiá»‡n Ä‘Ã£ Ä‘Æ°á»£c xÃ¡c thá»±c thÃ nh cÃ¡c Ä‘áº·c trÆ°ng ML
  - Táº­p trung vÃ o cÃ¡c chá»‰ sá»‘ dá»±a trÃªn phiÃªn vÃ  hÃ nh vi mua hÃ ng
  - Ghi Ä‘á»“ng thá»i vÃ o cáº£ online/offline stores

### 2\. Luá»“ng Huáº¥n luyá»‡n (Training Pipeline)

#### ğŸŒŸ Huáº¥n luyá»‡n PhÃ¢n tÃ¡n

  - **Cá»¥m Ray (Ray Cluster)**:
      - Xá»­ lÃ½ tinh chá»‰nh siÃªu tham sá»‘ phÃ¢n tÃ¡n thÃ´ng qua Ray Tune
      - Thá»±c hiá»‡n huáº¥n luyá»‡n mÃ´ hÃ¬nh cuá»‘i cÃ¹ng
      - TÃ­ch há»£p vá»›i MLflow Ä‘á»ƒ theo dÃµi thá»­ nghiá»‡m

#### ğŸ“¦ Quáº£n lÃ½ MÃ´ hÃ¬nh

  - **MLflow + MinIO + PostgreSQL**:
      - Theo dÃµi cÃ¡c thá»­ nghiá»‡m, tham sá»‘ vÃ  chá»‰ sá»‘
      - Quáº£n lÃ½ phiÃªn báº£n cÃ¡c táº¡o tÃ¡c mÃ´ hÃ¬nh (model artifacts)
      - Cung cáº¥p giao diá»‡n ngÆ°á»i dÃ¹ng kho mÃ´ hÃ¬nh (model registry UI) táº¡i `localhost:5001`

### 3\. Luá»“ng Phá»¥c vá»¥ (Serving Pipeline)

#### âš¡ Phá»¥c vá»¥ MÃ´ hÃ¬nh (Model Serving)

  - **Ray Serve**:
      - Táº£i mÃ´ hÃ¬nh tá»« kho MLflow
      - Tá»± Ä‘á»™ng má»Ÿ rá»™ng quy mÃ´ theo chiá»u ngang Ä‘á»ƒ Ä‘Ã¡p á»©ng thÃ´ng lÆ°á»£ng cao
      - Cung cáº¥p REST API cho cÃ¡c dá»± Ä‘oÃ¡n
  - **Dá»‹ch vá»¥ Äáº·c trÆ°ng (Feature Service)**:
      - Endpoint FastAPI Ä‘á»ƒ truy xuáº¥t Ä‘áº·c trÆ°ng
      - TÃ­ch há»£p vá»›i Redis cho cÃ¡c Ä‘áº·c trÆ°ng thá»i gian thá»±c

### 4\. Kháº£ nÄƒng Quan sÃ¡t (Observability)

#### ğŸ“¡ Chá»‰ sá»‘ & GiÃ¡m sÃ¡t

  - **SigNoz**:
      - Thu tháº­p dá»¯ liá»‡u OpenTelemetry
      - Cung cáº¥p giÃ¡m sÃ¡t cáº¥p dá»‹ch vá»¥
      - Truy cáº­p táº¡i `localhost:3301`
  - **Ray Dashboard**:
      - GiÃ¡m sÃ¡t cÃ¡c cÃ´ng viá»‡c huáº¥n luyá»‡n/phá»¥c vá»¥
      - Kháº£ dá»¥ng táº¡i `localhost:8265`
  - **Prometheus + Grafana**:
      - Theo dÃµi cÃ¡c chá»‰ sá»‘ cá»§a cá»¥m Ray
      - Trá»±c quan hÃ³a hiá»‡u nÄƒng há»‡ thá»‘ng
      - Truy cáº­p táº¡i `localhost:3009`
  - **Superset**:
      - Trá»±c quan hÃ³a dá»¯ liá»‡u trong Data Warehouse
      - Truy cáº­p táº¡i `localhost:8089`
  - **Elasticsearch**:
      - Cáº£nh bÃ¡o cÃ¡c sá»± kiá»‡n khÃ´ng há»£p lá»‡

#### ğŸ”’ Quáº£n lÃ½ Truy cáº­p

  - **NGINX Proxy Manager**:
      - Proxy ngÆ°á»£c (Reverse proxy) cho táº¥t cáº£ cÃ¡c dá»‹ch vá»¥
      - Cháº¥m dá»©t SSL/TLS (SSL/TLS termination)
      - Kiá»ƒm soÃ¡t truy cáº­p vÃ  Ä‘á»‹nh tuyáº¿n

Kiáº¿n trÃºc Æ°u tiÃªn Ä‘á»™ tin cáº­y, kháº£ nÄƒng má»Ÿ rá»™ng vÃ  kháº£ nÄƒng quan sÃ¡t trong khi váº«n duy trÃ¬ sá»± tÃ¡ch biá»‡t rÃµ rÃ ng cÃ¡c má»‘i quan tÃ¢m giá»¯a cÃ¡c giai Ä‘oáº¡n cá»§a pipeline. Má»—i thÃ nh pháº§n Ä‘Æ°á»£c Ä‘Ã³ng gÃ³i trong container vÃ  cÃ³ thá»ƒ Ä‘Æ°á»£c triá»ƒn khai Ä‘á»™c láº­p báº±ng Docker Compose.

-----
